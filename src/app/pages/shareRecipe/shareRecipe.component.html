<app-navbar [enableSearch]="false" [activeRoute]="'share-recipe'"></app-navbar>
<div class="share-recipe-page">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <h1 class="hero-title">{{ 'shareRecipe.title' | translate }}</h1>
      <p class="hero-subtitle">{{ 'shareRecipe.subtitle' | translate }}</p>
    </div>
  </section>

  <!-- Form Section -->
  <section class="form-section">
    <div class="container">
      <form [formGroup]="recipe" class="recipe-form">
        <!-- Recipe Name -->
        <div class="form-group">
          <label for="recipeName" class="form-label">
            <i class="fas fa-utensils"></i>
            {{ 'shareRecipe.form.name' | translate }}
          </label>
          <input 
            type="text" 
            id="recipeName" 
            [placeholder]="'shareRecipe.form.namePlaceholder' | translate"
            [ngClass]="{'error-box': recipe.get('name')?.invalid && recipe.get('name')?.touched}"
            formControlName="name" 
            [(ngModel)]="newRecipe">
          @if (recipe.get('name')?.touched && recipe.get('name')?.getError('required')) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ 'shareRecipe.form.required' | translate }}</span>
            </div>
          }
        </div>

        <!-- Recipe Type -->
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-tag"></i>
            {{ 'shareRecipe.form.type' | translate }}
          </label>
          <div class="recipe-type-grid">
            <div class="type-option">
              <input type="radio" name="type" id="type1" formControlName="type" value="Cold Desserts">
              <label for="type1" [ngClass]="{'selected': recipe.get('type')?.value === 'Cold Desserts'}">
                <i class="fas fa-ice-cream"></i>
                <span>{{ 'shareRecipe.types.coldDesserts' | translate }}</span>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" name="type" id="type2" formControlName="type" value="Baked Desserts">
              <label for="type2" [ngClass]="{'selected': recipe.get('type')?.value === 'Baked Desserts'}">
                <i class="fas fa-birthday-cake"></i>
                <span>{{ 'shareRecipe.types.bakedDesserts' | translate }}</span>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" name="type" id="type3" formControlName="type" value="Pastries">
              <label for="type3" [ngClass]="{'selected': recipe.get('type')?.value === 'Pastries'}">
                <i class="fas fa-cookie"></i>
                <span>{{ 'shareRecipe.types.pastries' | translate }}</span>
              </label>
            </div>
            <div class="type-option">
              <input type="radio" name="type" id="type4" formControlName="type" value="cookies">
              <label for="type4" [ngClass]="{'selected': recipe.get('type')?.value === 'cookies'}">
                <i class="fas fa-cookie-bite"></i>
                <span>{{ 'shareRecipe.types.cookies' | translate }}</span>
              </label>
            </div>
          </div>
          @if (recipe.get('type')?.touched && recipe.get('type')?.invalid) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ 'shareRecipe.form.chooseType' | translate }}</span>
            </div>
          }
        </div>

        <!-- Ingredients -->
        <div class="form-group">
          <label for="ingredients" class="form-label">
            <i class="fas fa-list"></i>
            {{ 'shareRecipe.form.ingredients' | translate }}
          </label>
          <textarea 
            [placeholder]="'shareRecipe.form.ingredientsPlaceholder' | translate" 
            id="ingredients"
            [ngClass]="{'error-box': recipe.get('ingredients')?.invalid && recipe.get('ingredients')?.touched}"
            formControlName="ingredients" 
            [(ngModel)]="newingredients"
            rows="5"></textarea>
          @if (recipe.get('ingredients')?.touched && recipe.get('ingredients')?.getError('required')) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ 'shareRecipe.form.required' | translate }}</span>
            </div>
          }
        </div>

        <!-- Instructions -->
        <div class="form-group">
          <label for="prepare" class="form-label">
            <i class="fas fa-clipboard-list"></i>
            {{ 'shareRecipe.form.prepare' | translate }}
          </label>
          <textarea 
            [placeholder]="'shareRecipe.form.preparePlaceholder' | translate" 
            id="prepare"
            [ngClass]="{'error-box': recipe.get('prepare')?.invalid && recipe.get('prepare')?.touched}"
            formControlName="prepare" 
            [(ngModel)]="newPrepare"
            rows="6"></textarea>
          @if (recipe.get('prepare')?.touched && recipe.get('prepare')?.getError('required')) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ 'shareRecipe.form.required' | translate }}</span>
            </div>
          }
        </div>

        <!-- Photo Upload -->
        <div class="form-group">
          <label for="photoUpload" class="form-label">
            <i class="fas fa-camera"></i>
            {{ 'shareRecipe.form.photo' | translate }}
          </label>
          @if (imagePreview()) {
            <div class="image-preview-container">
              <img [src]="imagePreview()!" alt="Preview" class="image-preview">
              <button type="button" class="remove-image-btn" (click)="removeImage()" aria-label="Remove image">
                <i class="fas fa-times"></i>
              </button>
            </div>
          } @else {
            <input type="file" id="photoUpload" accept="image/*" style="display: none;" (change)="onFileSelected($event)" #photoInput>
            <button type="button" class="upload-btn" (click)="photoInput.click()">
              <i class="fas fa-cloud-arrow-up"></i>
              <span>{{ 'shareRecipe.form.uploadPhoto' | translate }}</span>
            </button>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email" class="form-label">
            <i class="fas fa-envelope"></i>
            {{ 'shareRecipe.form.email' | translate }}
          </label>
          <input 
            type="email" 
            id="email" 
            [placeholder]="'shareRecipe.form.emailPlaceholder' | translate"
            formControlName="email"
            [ngClass]="{'error-box': recipe.get('email')?.invalid && recipe.get('email')?.touched && recipe.get('email')?.value}"
            [(ngModel)]="newEmail">
          @if (recipe.get('email')?.touched && recipe.get('email')?.invalid && recipe.get('email')?.value) {
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ 'shareRecipe.form.validEmail' | translate }}</span>
            </div>
          }
        </div>

        <!-- Success/Error Messages -->
        @if (successMessage()) {
          <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <span>{{ 'shareRecipe.form.submitSuccess' | translate }}</span>
          </div>
        }

        @if (errorMessage()) {
          <div class="alert alert-error">
            <i class="fas fa-exclamation-triangle"></i>
            <span>{{ errorMessage() === 'Please fill in all required fields correctly.' ? ('shareRecipe.form.fillRequired' | translate) : ('shareRecipe.form.submitError' | translate) }}</span>
          </div>
        }

        <!-- Submit Button -->
        <div class="form-actions">
          <button 
            type="button" 
            class="submit-btn" 
            [ngClass]="{'submit-valid': recipe.valid}"
            [disabled]="!recipe.valid || isLoading()" 
            (click)="onSubmit()">
            @if (!isLoading()) {
              <i class="fas fa-paper-plane"></i>
              <span>{{ 'shareRecipe.form.submit' | translate }}</span>
            }
            @if (isLoading()) {
              <svg class="spinner" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="2" x2="12" y2="6"></line>
                <line x1="12" y1="18" x2="12" y2="22"></line>
                <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                <line x1="2" y1="12" x2="6" y2="12"></line>
                <line x1="18" y1="12" x2="22" y2="12"></line>
                <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
              </svg>
              <span>{{ 'shareRecipe.form.sending' | translate }}</span>
            }
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
<app-footer></app-footer>
