<div #loginAlert class="alert-box" style="display:none;">
  <i class="material-icons alert-icon">info</i>
    <div class="alert-content">
    <h4>Oops!</h4>
    <p>You need to login or sign up to continue shopping.
      <!-- <a routerLink="/shop">shopping page</a> -->
    </p>
  </div>
</div>

<div #alertCart class="alert-cart" style="display:none;" >
  <i class="fas fa-check-circle check-icon"></i>
  <span>Item added to your cart successfully!</span>
</div>

<div #alertFavorite class="alert-favorite" style="display:none;">
  <i class="material-icons favorite-icon">favorite</i>
  <span>Added to favorites!</span>
</div>

@if (searchOn) {
  <div class="search-result">
    <h3 class="search-result-title"  > The Search Result : </h3>
    <!-- <div class="search-result-line"></div> -->
  </div>
}

@if (isLoading) {
  <div class="loading-container">
    <svg width="120" height="140" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="donut-loader">
      <style>
        .donut-bouncer {
          animation: cuteBounce 0.8s ease-in-out infinite;
          transform-origin: center bottom;
        }
        .donut-roller {
          animation: roll 2s linear infinite;
          transform-origin: center;
        }
        .donut-shadow {
          animation: shadowScale 0.8s ease-in-out infinite;
          transform-origin: center;
          opacity: 0.2;
        }
        .face-blink {
          animation: blink 4s infinite;
          transform-origin: center 55px;
        }
        @keyframes roll {
          100% { transform: rotate(360deg); }
        }
        @keyframes cuteBounce {
          0%, 100% { 
            transform: translateY(0) scale(1.05, 0.9);
            animation-timing-function: ease-out;
          }
          50% { 
            transform: translateY(-15px) scale(0.95, 1.05);
            animation-timing-function: ease-in;
          }
        }
        @keyframes shadowScale {
          0%, 100% { transform: scale(1); opacity: 0.2; }
          50% { transform: scale(0.7); opacity: 0.1; }
        }
        @keyframes blink {
          0%, 48%, 52%, 100% { transform: scaleY(1); }
          50% { transform: scaleY(0.1); }
        }
      </style>
      <ellipse cx="60" cy="105" rx="30" ry="5" fill="#000000" class="donut-shadow"/>
      <g class="donut-bouncer">
        <g class="donut-roller">
          <circle cx="60" cy="60" r="36" stroke="#F4D0A9" stroke-width="28" />
          <circle cx="60" cy="60" r="36" stroke="#FFABD6" stroke-width="22" stroke-dasharray="190 40" stroke-linecap="round" transform="rotate(-30 60 60)"/>
          <path d="M45 35 Q 55 30, 65 32" stroke="white" stroke-width="4" stroke-linecap="round" opacity="0.6"/>
          <path d="M80 45 Q 85 55, 82 65" stroke="white" stroke-width="4" stroke-linecap="round" opacity="0.6" transform="rotate(20 60 60)"/>
          <g fill="#FFFFFF">
            <rect x="57" y="22" width="6" height="10" rx="3" fill="#AEEEEE" transform="rotate(15 60 30)"/>
            <rect x="88" y="57" width="10" height="6" rx="3" fill="#FFF68F" transform="rotate(10 94 60)"/>
            <rect x="55" y="88" width="6" height="10" rx="3" fill="#C1FFC1" transform="rotate(-20 58 94)"/>
            <rect x="20" y="55" width="10" height="6" rx="3" fill="#FFDAB9" transform="rotate(-10 26 58)"/>
            <rect x="35" y="35" width="6" height="8" rx="3" fill="#E6E6FA" transform="rotate(45 38 40)"/>
          </g>
          <g class="face-blink">
            <circle cx="50" cy="55" r="4" fill="#4A4A4A"/>
            <circle cx="70" cy="55" r="4" fill="#4A4A4A"/>
            <circle cx="52" cy="53" r="1.5" fill="white"/>
            <circle cx="72" cy="53" r="1.5" fill="white"/>
            <ellipse cx="45" cy="62" rx="3.5" ry="2" fill="#FF69B4" opacity="0.5"/>
            <ellipse cx="75" cy="62" rx="3.5" ry="2" fill="#FF69B4" opacity="0.5"/>
            <path d="M 56 63 Q 60 66, 64 63" stroke="#4A4A4A" stroke-width="2" stroke-linecap="round" fill="none"/>
          </g>
        </g>
      </g>
    </svg>
    <p class="loading-text">{{ 'common.loading' | translate }}</p>
  </div>
} @else {
<div class="center">
  @for (product of products|searchPipe :searchValue ; track $index) {
    <div class="container">
      <div class="productGrid">
        <div class="productCard">
          <div class="favorite-btn-wrapper">
            <button
              type="button"
              class="favorite-btn"
              (click)="toggleFavorite(product.id)"
              [class.favorited]="isFavorite(product.id)"
              [title]="isFavorite(product.id) ? 'Remove from favorites' : 'Add to favorites'">
              <i class="material-icons">{{ isFavorite(product.id) ? 'favorite' : 'favorite_border' }}</i>
            </button>
          </div>
          @if (admin && isFromFirestore(product)) {
            <button
              type="button"
              class="delete-btn"
              (click)="deleteProduct(product)"
              title="Delete product">
              <i class="material-icons">delete</i>
            </button>
          }
          <img [src]="product.img" alt="">
          <div class="productInfo">
            <h3 class="productTitle">{{product.title}}</h3>
            <div class="productMeta">
              <span class="productPrice"> {{product.price | currency : "JD" : "code"}}</span>
              <span class="productQuantity">{{product.quantity}}</span>
            </div>
              <div class="productActions">
                <button type="button" (click)="addToCart(product.id)" class="btnPrimary" >
                  <i class="material-icons"  >add_shopping_cart</i>
                  <span>{{ 'shop.product.addToCart' | translate }}</span>
                </button>

                <button type="button" class="btn btnSecondary"
                (click)="viewRecipeDetails(product.id)" >
                  {{ 'shop.product.viewDetails' | translate }}
                </button>
                <!-- <i ngIf="admin == true" class="fa-solid fa-pan-square" ></i> -->
              </div>
          </div>
        </div>
      </div>
    </div>

  }@empty {
      <div class="empty-state">
        <div class="empty-state-icon">üîç</div>
        <h3>{{ 'common.error' | translate }}</h3>
        <p>{{ 'shop.noProductsFound' | translate }}: "{{sInput}}"</p>
      </div>
  }
</div>
}
